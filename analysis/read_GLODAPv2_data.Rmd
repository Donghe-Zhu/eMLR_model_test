---
title: "Read and plot GLODAPv2 data"
author: "Donghe Zhu and Dr Jens Daniel MÃ¼ller"
date:  "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  workflowr::wflow_html:
    number_sections: true
    toc_depth: 3
    toc_float:
      collapsed: false
editor_options:
  chunk_output_type: console
---


```{r global_options, include = FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

# Required Packages
```{r Load_package}
library(tidyverse)
```

```{r read_model_dile, include = FALSE}

nc_data_tibble_regrided <-  read_csv(
  here::here(
    "data",
    "variable_regrided_Aug.csv"
  )
)

```

```{r ggplot_theme, include = FALSE}
theme_set(theme_bw())
```

# Read GLODAPv2 data

```{r read_obs_and_regrid_depth}

# read csv file
GLODAP <-
  read_csv(
    here::here(
      "data",
      "GLODAPv2.2020_clean_2007.csv"
    )
  )

# set depth range
depth_model <- unique(nc_data_tibble_regrided$depth)
range_temp <- 1:(length(depth_model) - 1)
for (i in 1:(length(depth_model) - 1))  {
  range_temp[i] <- (depth_model[i] + depth_model[i + 1]) / 2
}
  range <- c(0)
  range <- append(range, range_temp) 
  range <- append(range, Inf)
  print(range)

# convert observational depth to 60 model depth
GLODAP <- GLODAP %>%
  mutate(depth = cut(depth, range, depth_model), depth = as.numeric(as.character(depth)))

# write file
GLODAP %>%
  write_csv(here::here("data",
                       "GLODAP_regrid_depth.csv"))

rm(GLODAP, nc_data_tibble_regrided)

```
